<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tu Tienda en Línea</title>
  <!-- Agrega los enlaces a los archivos CSS de Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="resources/public/css/card.css">  
  <link rel="stylesheet" href="resources/css/features.css">  
  <link rel="stylesheet" href="resources/css/footer.css"> 
  <style>
    /* Estilos de las tarjetas (cards) */
    .card {
      margin-bottom: 30px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s;
      border: none;
      border-radius: 10px;
      overflow: hidden;
    }

    .card:hover {
      transform: scale(1.05);
    }

    .card-img-top {
      height: 200px;
      object-fit: cover;
      border-bottom: 1px solid #eee;
    }

    .card-body {
      padding: 20px;
    }

    .card-title {
      font-size: 1.8rem;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .card-text {
      color: #555;
      margin-bottom: 10px;
      font-size: 0.8rem; /* Tamaño de texto más pequeño */
    }

    .btn-primary {
      background-color: #6c757d;
      border-color: #6c757d;
      transition: background-color 0.3s;
      font-size: 0.7rem;
    }

    .btn-primary:hover {
      background-color: #495057;
      border-color: #495057;
    }
  </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
          <!-- Logo y nombre de la tienda -->
          <a class="navbar-brand" href="/admin_dashboard">
              <img src="resources/img/D-troit Audio Logo.png" alt="Logo de D-troit" height="50" > 
            </a>
      
          <!-- Botón de hamburguesa para dispositivos móviles -->
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
      
          <!-- Menú de navegación -->
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
              <!-- Elementos de la cuenta del usuario dentro del menú hamburguesa con modal de sesion -->
              <li class="nav-item d-lg-none">
                <a class="nav-link" href="/login" >Compras</a>
              </li>
              <li class="nav-item d-lg-none">
                <a class="nav-link" href="/index" >Salir</a>
              </li>
            </ul>
          </div>
      
          <!-- Elementos de la cuenta del usuario fuera del menú hamburguesa con modal de sesion -->
          <div class="navbar-nav ms-auto d-none d-lg-flex">
                  <a class="nav-link" href="/login">
                      <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-cart3 text-dark" viewBox="0 0 16 16">
                          <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .49.598l-1 5a.5.5 0 0 1-.465.401l-9.397.472L4.415 11H13a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5M3.102 4l.84 4.479 9.144-.459L13.89 4H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4m7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4m-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2m7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/>
                      </svg>
                  </a>
              
            <a class="nav-link" href="/index" >Salir</a>
          </div>
        </div>
      </nav>
      
  <div class="container">
    <div class="text-center my-5">
      <h2 class="display-4">Portal de administrador</h2>
      <p class="lead">Agrega, elimina productos, y gestiona tus ventas</p>
    </div>
    
    <div class="container">
      <!-- Agrega el botón para abrir el SweetAlert -->
      <button id="agregarProductoBtn" class="btn btn-primary">Agregar Producto</button>
  </div>

  <% productos.forEach(producto => { %>
    <div class="col-md-4">
        <div class="card">
            <img src="resources/uploads/<%= producto.imagen_url %>" class="card-img-top" alt="Product Image">
            <div class="card-body">
                <h5 class="card-title"> <%= producto.titulo %> </h5>
                <p class="card-text"> <%= producto.descripcion %> </p>
                <p class="card-text"> Precio: $<%= producto.precio %> </p>
                <button class="btn btn-primary" onclick="showSweetAlert('resources/uploads/<%= producto.imagen_url %>')">Buy Now</button>
                <button class="btn btn-primary" onclick="eliminarProducto('<%= producto.id %>')">Eliminar</button>
            </div>
        </div>
    </div>
<% }); %>
  
  

  <!-- Footer -->
  <footer>
    <div class="container text-center">
      <div class="row">
        <div class="col-md-12">
          <h3 class="footer-logo">Tu Tienda</h3>
          <p class="footer-info">Descubre productos increíbles en nuestra tienda.</p>
        </div>
        <div class="col-md-12">
          <div class="footer-social-icons">
            <a href="#"><i class="fab fa-facebook"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JavaScript and dependencies (optional) -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.7/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="resources/js/script.js"></script>
  <script>
    function eliminarProducto(id) {
    // Puedes realizar una solicitud al servidor para eliminar el producto con el ID proporcionado
    fetch(`/eliminarProducto/${id}`, {
        method: 'DELETE',
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Eliminación exitosa, ahora puedes actualizar la interfaz o realizar otras acciones necesarias
            console.log('Producto eliminado correctamente');

            // Opcional: Puedes eliminar la tarjeta de la interfaz
            const cardToRemove = document.querySelector(`#productoId${id}`).closest('.col-md-4');
            if (cardToRemove) {
                cardToRemove.remove();
            }
        } else {
            console.error('Error al eliminar el producto');
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

  </script>
  <script>
    function eliminarProducto(id) {
    // Realiza una solicitud DELETE al servidor para eliminar el producto
    fetch(`/eliminarProducto/${id}`, {
        method: 'DELETE',
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Eliminación exitosa, puedes actualizar la interfaz o realizar otras acciones necesarias
            console.log('Producto eliminado correctamente');

            // Opcional: Puedes eliminar la tarjeta de la interfaz
            const cardToRemove = document.querySelector(`#productoId${id}`).closest('.col-md-4');
            if (cardToRemove) {
                cardToRemove.remove();
            }
        } else {
            console.error('Error al eliminar el producto');
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

  </script>
  <script>
    function showSweetAlert(imageUrl) {
      Swal.fire({
        title: "Sweet!",
        text: "Modal with a custom image.",
        imageUrl: imageUrl,
        imageWidth: 400,
        imageHeight: 200,
        imageAlt: "Custom image"
      });
    }
  </script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<!-- SweetAlert script -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script>
  document.getElementById('agregarProductoBtn').addEventListener('click', function showSweetAlert() {
   Swal.fire({
      title: 'Agregar Producto',
      html:
         '<form id="agregarProductoForm" enctype="multipart/form-data">' +
         '   <input name="titulo" id="titulo" class="swal2-input" placeholder="Título">' +
         '   <textarea name="descripcion" id="descripcion" class="swal2-input" rows="4" style="overflow: hidden;" placeholder="Descripción"></textarea>' +
         '   <div class="custom-file custom-file-sm mb-2">' +
         '       <input type="file" name="imagen_url" class="custom-file-input" id="imagenUrl" accept="image/*">' +
         '       <label class="custom-file-label" for="imagenUrl">Selecciona una imagen</label>' +
         '   </div>' +
         '   <div class="input-group">' +
         '       <div class="input-group-prepend">' +
         '           <span class="input-group-text">$</span>' +
         '       </div>' +
         '       <input name="precio" type="number" id="precio" class="form-control" placeholder="Precio">' +
         '   </div>' +
         '</form>',
      focusConfirm: false,
      showCancelButton: true,
      confirmButtonText: 'Enviar',
      preConfirm: () => {
         const form = Swal.getPopup().querySelector('#agregarProductoForm');
         const formData = new FormData(form);

         if (!formData.get('titulo') || !formData.get('descripcion') || !formData.get('imagen_url') || !formData.get('precio')) {
            Swal.showValidationMessage('Todos los campos son obligatorios');
         }

         return formData;
      },
      onOpen: () => {
         const imagenInput = Swal.getPopup().querySelector('#imagenUrl');
         const customFileLabel = Swal.getPopup().querySelector('.custom-file-label');

         imagenInput.addEventListener('change', () => {
            customFileLabel.textContent = imagenInput.files[0] ? imagenInput.files[0].name : 'Selecciona una imagen';
         });
      }
   }).then((result) => {
      if (result.isConfirmed) {
         fetch('/agregarProducto', {
            method: 'POST',
            body: result.value,
         })
            .then(response => response.json())
            .then(data => {
               if (data.success) {
                  Swal.fire('¡Producto agregado!', '', 'success');
               } else {
                  Swal.fire('Error al agregar el producto', '', 'error');
               }
            })
            .catch(error => {
               console.error('Error:', error);
               Swal.fire('Error al agregar el producto', '', 'error');
            });
      }
   });
});

</script>
</body>
</html>